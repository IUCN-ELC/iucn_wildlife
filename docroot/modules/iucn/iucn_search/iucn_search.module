<?php

/**
 * Implements hook_theme().
 */
function iucn_search_theme($existing, $type, $theme, $path) {
  $return = [];
  $return ['iucn_search_results'] = [
    'variables' => [
      'items' => NULL,
    ],
    'path' => 'themes/iucn_frontend/templates/iucn_search',
  ];
  return $return;
}

/**
 * Implements hook_edw_search_solr_facet_info().
 */
function iucn_search_edw_search_solr_facet_info(\Drupal\iucn_search\edw\solr\SolrSearchServer $server) {
  $ret = array();
  // @ToDo: Translate facet titles
  $facets = [
    'field_region' => [
      'title' => 'Region',
      'placeholder' => 'Add regions...',
      'bundle' => 'regions',
    ],
    'field_court' => [
      'title' => 'Court',
      'placeholder' => 'Add courts...',
      'bundle' => 'court_levels',
    ],
    'field_offences' => [
      'title' => 'Offence',
      'placeholder' => 'Add offences...',
      'bundle' => 'offences',
    ],
    'field_species' => [
      'title' => 'Species',
      'placeholder' => 'Add species...',
      'bundle' => 'species',
    ],
    'field_wildlife_legislation' => [
      'title' => 'Wildlife legislation',
      'placeholder' => 'Add wildlife legislations...',
      'bundle' => 'wildlife_legislations',
    ],
//    'field_ecolex_subjects' => [
//      'title' => 'Subject',
//      'placeholder' => 'Add subjects...',
//      'bundle' => 'ecolex_subjects',
//    ],
//    'field_country' => [
//      'title' => 'Country',
//      'placeholder' => 'Add countries...',
//      'bundle' => 'country',
//    ],
//    'field_type_of_text' => [
//      'title' => 'Type of court',
//      'placeholder' => 'Add types...',
//      'bundle' => 'document_types',
//    ],
//    'field_territorial_subdivisions' => [
//      'title' => 'Sub-national/state level',
//      'placeholder' => 'Add territory...',
//      'bundle' => 'territorial_subdivisions',
//    ],
//      'field_subdivision' => [
//        'title' => 'Subdivision',
//        'field' => 'field_subdivision',
//        'bundle' => 'subdivisions',
//      ],
//      'field_justices' => [
//        'title' => 'Justice',
//        'field' => 'field_justices',
//        'bundle' => 'justices',
//      ],
//      'field_instance' => [
//        'title' => 'Instance',
//        'field' => 'field_instance',
//        'bundle' => 'instances',
//      ],
//      'field_decision_status' => [
//        'title' => 'Decision status',
//        'field' => 'field_decision_status',
//        'bundle' => 'decision_status',
//      ],
//      'field_court_jurisdiction' => [
//        'title' => 'Court jurisdiction',
//        'field' => 'field_court_jurisdiction',
//        'bundle' => 'court_jurisdictions',
//      ],
  ];
  $mappings = $server->getSolrFieldsMappings();
  foreach ($facets as $id => $config) {
    $solr_field_name = $mappings[$id];
    $ret[$id] = new \Drupal\iucn_search\edw\solr\SolrFacet($id, $config['bundle'], $solr_field_name, $config);
  }
  return $ret;
}

/**
 * Implements hook_edw_search_solr_filter_query_fields_info().
 */
function iucn_search_edw_search_solr_filter_query_fields_info() {
  // All taxonomy fields should be filtered in search.
  $fields = [];
  $ids = \Drupal::entityQuery('field_config')
    ->condition('id', 'node.court_decision.', 'STARTS_WITH')
    ->execute();
  $field_configs = Drupal\field\Entity\FieldConfig::loadMultiple($ids);
  foreach ($field_configs as $field_instance) {
    // Get all court_decision taxonomy fields.
    if ($field_instance->getType() == 'entity_reference' &&
      $field_instance->getSetting('target_type') == 'taxonomy_term') {
      $fields[] = $field_instance->getName();
    }
  }
  return $fields;
}
